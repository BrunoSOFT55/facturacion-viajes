<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Comprobante de Servicio - Altamirano Nosiglia Viajes</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#0b1f3a">
<link rel="manifest" href="manifest.json">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root{
 --azul:#0b1f3a;
 --azul2:#162f5f;
}

body{
 background:#dde3ee;
 font-family:'Segoe UI', sans-serif;
}

.factura-box{
 max-width:950px;
 margin:auto;
 background:#fff;
 padding:40px;
 border-radius:14px;
 box-shadow:0 18px 40px rgba(0,0,0,.18);
 border-top:12px solid var(--azul);
}

.encabezado{
 display:flex;
 align-items:center;
 gap:15px;
 border-bottom:2px solid var(--azul);
 padding-bottom:18px;
 margin-bottom:30px;
}

.encabezado img{max-height:90px}

.marca{
 font-size:24px;
 font-weight:800;
 color:var(--azul);
}

.sub{font-size:13px;color:#666}

.total-box{
 background:#f3f5f8;
 border:2px solid var(--azul2);
 padding:18px;
 border-radius:10px;
 font-size:24px;
 font-weight:800;
 color:var(--azul2);
 margin-top:20px;
}

.acciones{
 display:flex;
 gap:10px;
 justify-content:flex-end;
 flex-wrap:wrap;
}

@media (max-width:768px){
 .factura-box{padding:20px}
 .encabezado{flex-direction:column;text-align:center}
}

@media (max-width:576px){
 .acciones{flex-direction:column;gap:12px}
 .acciones button{
  width:100%;
  font-size:16px;
  padding:14px;
  border-radius:10px;
 }
}

@media print{
 body{background:#fff}
 .no-print, footer, #historialBox{display:none!important}
 .factura-box{box-shadow:none;border:none}
}
</style>
</head>

<body>

<div class="factura-box">

  <div class="encabezado">
    <img src="logo.png">
    <div>
      <div class="marca">Altamirano Nosiglia Viajes</div>
      <div class="sub">Comprobante de Servicio</div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <input type="text" id="cliente" class="form-control" placeholder="Cliente">
    </div>
    <div class="col-md-3">
      <input type="date" id="fecha" class="form-control">
    </div>
  </div>

  <div id="tablaCarga" class="no-print">
    <div class="row g-3 mb-3">
      <div class="col-md-8">
        <input type="text" id="desc" class="form-control" placeholder="Detalle">
      </div>
      <div class="col-md-4">
        <input type="number" id="precio" class="form-control" placeholder="Importe">
      </div>
    </div>

    <button onclick="agregar()" class="btn btn-primary mb-3">Agregar</button>
  </div>

  <table class="table table-bordered mt-4">
    <thead class="table-light">
      <tr>
        <th>Detalle</th>
        <th class="text-end">Importe</th>
      </tr>
    </thead>
    <tbody id="tablaDetalle"></tbody>
  </table>

  <div class="total-box text-end">
    TOTAL $ <span id="total">0.00</span>
  </div>

  <div class="acciones mt-4 no-print">
    <button onclick="nuevaFactura()" class="btn btn-outline-danger">Nueva Factura</button>
    <button onclick="guardarHistorial()" class="btn btn-secondary">Guardar Historial</button>
    <button onclick="enviarWhats()" class="btn btn-outline-success">Enviar WhatsApp</button>
    <button onclick="window.print()" class="btn btn-success">Imprimir / PDF</button>
    <button onclick="irAPresupuesto()" class="btn btn-outline-primary">Ir a Presupuesto</button>
  </div>

  <!-- HISTORIAL -->
  <div id="historialBox" class="mt-5 no-print">
    <input type="text" id="buscar" class="form-control mb-2"
      placeholder="Buscar comprobantes..."
      onkeyup="filtrarHistorial()">

    <table class="table table-sm table-bordered d-none" id="tablaHistorial">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Cliente</th>
          <th>Detalle</th>
          <th class="text-end">Total</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<footer class="bg-dark text-white text-center py-4 mt-5">
  <h6 class="mb-1">Rodríguez Bruno</h6>
  <small class="text-secondary">
    Técnico en Desarrollo de Software<br>
    Sistemas Web · Apps · Soluciones Digitales
  </small>
</footer>

<script>
let total = 0;
let detallesFactura = [];

const cliente = document.getElementById("cliente");
const fecha = document.getElementById("fecha");
const desc = document.getElementById("desc");
const precio = document.getElementById("precio");
const tablaDetalle = document.getElementById("tablaDetalle");

function agregar(){
 if(desc.value === "" || precio.value === ""){
  alert("Complete el detalle y el importe");
  return;
 }

 let importe = parseFloat(precio.value);

 tablaDetalle.innerHTML += `
  <tr>
   <td>${desc.value}</td>
   <td class="text-end">$ ${importe.toFixed(2)}</td>
  </tr>
 `;

 // SOLO DETALLE (sin importe)
 detallesFactura.push(desc.value);

 total += importe;
 document.getElementById("total").innerText = total.toFixed(2);

 desc.value="";
 precio.value="";
}

function nuevaFactura(){
 if(!confirm("¿Desea iniciar una nueva factura?")) return;
 cliente.value="";
 fecha.value="";
 tablaDetalle.innerHTML="";
 detallesFactura=[];
 total=0;
 document.getElementById("total").innerText="0.00";
}

function enviarWhats(){
 let msg = `Hola ${cliente.value}
Fecha: ${fecha.value}
Total: $ ${total.toFixed(2)}`;
 window.open("https://wa.me/?text="+encodeURIComponent(msg));
}

function guardarHistorial(){
 let hist = JSON.parse(localStorage.getItem("historial") || "[]");

 hist.push({
  fecha: fecha.value,
  cliente: cliente.value,
  detalle: detallesFactura.join(" | "),
  total: total.toFixed(2)
 });

 localStorage.setItem("historial", JSON.stringify(hist));
 alert("Comprobante guardado");
 cargarHistorial();
}

function cargarHistorial(){
 let hist = JSON.parse(localStorage.getItem("historial") || "[]");
 let tbody = document.querySelector("#tablaHistorial tbody");
 tbody.innerHTML="";

 hist.reverse().forEach(h=>{
  tbody.innerHTML += `
   <tr>
    <td>${h.fecha}</td>
    <td>${h.cliente}</td>
    <td>${h.detalle}</td>
    <td class="text-end">$ ${h.total}</td>
   </tr>
  `;
 });
}

function filtrarHistorial(){
 let q = buscar.value.toLowerCase();
 let t = document.getElementById("tablaHistorial");
 if(q===""){t.classList.add("d-none");return;}
 t.classList.remove("d-none");
 document.querySelectorAll("#tablaHistorial tbody tr").forEach(f=>{
  f.style.display = f.innerText.toLowerCase().includes(q) ? "" : "none";
 });
}

function irAPresupuesto(){
 window.location.href = "presupuesto.html";
}

window.onload = cargarHistorial;

if('serviceWorker' in navigator){
 navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>


